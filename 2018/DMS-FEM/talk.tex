\documentclass[hide notes,intlimits,usenames,dvipsnames]{beamer}

\mode<presentation>
{
  \usetheme{Singapore}
  \usefonttheme{professionalfonts}
  \setbeamertemplate{blocks}[rounded][shadow=true]
  \setbeamercovered{transparent}
  \setbeamertemplate{footline}[frame number]
}

% load packages
\usepackage[english]{babel}
\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[multidot]{grffile}
\usepackage{verbatim,empheq}

\usepackage{tikz}
\usetikzlibrary{shapes,arrows,shadows}
\usetikzlibrary{decorations.pathreplacing}

\usepackage{animate}
\usepackage{amsmath,verbatim}

% see http://tex.stackexchange.com/questions/86188/labelling-with-arrows-in-an-automated-way

\newif\ifclipme\clipmetrue
\tikzset{labelstyle/.style={LabelStyle/.append style={#1}},linestyle/.style={LineStyle/.append style={#1}}}
\tikzset{LabelStyle/.initial={},LineStyle/.initial={}}

\newcommand{\mathWithDescription}[4][]{{%
    \tikzset{#1}%
    \tikz[baseline]{
        \node[draw=red,rounded corners,anchor=base] (m#4) {$\displaystyle#2$};
        \ifclipme\begin{pgfinterruptboundingbox}\fi
            \node[above of=m#4,font=\strut, LabelStyle] (l#4) {#3};
            \draw[-,red, LineStyle] (l#4) to (m#4);
        \ifclipme\end{pgfinterruptboundingbox}\fi
    }%
}}

\newcommand{\mathWithDescriptionStarred}[3][]{{%
    \clipmefalse%
    \mathWithDescription[#1]{#2}{#3}{\themathLabelNode}%
}}

\newcounter{mathLabelNode}

\newcommand{\mathLabelBox}[3][]{%
   \stepcounter{mathLabelNode}%
   \mathWithDescription[#1]{#2}{#3}{\themathLabelNode}%
   \vphantom{\mathWithDescriptionStarred[#1]{#2}{#3}{\themathLabelNode}}%
}

\definecolor{dark red}{HTML}{E41A1C}
\definecolor{dark green}{HTML}{4DAF4A}
\definecolor{dark violet}{HTML}{984EA3}
\definecolor{dark blue}{HTML}{084594}
\definecolor{dark orange}{HTML}{FF7F00}
\definecolor{light blue}{HTML}{377EB8}
\definecolor{light red}{HTML}{FB9A99}
\definecolor{light violet}{HTML}{CAB2D6}

\newcommand{\CC}{\mathbb{C}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\ZZ}{\mathbb{Z}}

\newcommand{\Kcal}{\mathcal{K}}
\newcommand{\Xcal}{\mathcal{X}}

\newcommand{\bF}{\mathbf{F}}
\newcommand{\bQ}{\mathbf{Q}}
\newcommand{\bU}{\mathbf{U}}
\newcommand{\bX}{\mathbf{X}}

\newcommand{\bb}{\mathbf{b}}
\newcommand{\bc}{\mathbf{c}}
\newcommand{\bn}{\mathbf{n}}
\newcommand{\bp}{\mathbf{p}}
\newcommand{\bq}{\mathbf{q}}
\newcommand{\bs}{\mathbf{s}}
\newcommand{\bu}{\mathbf{u}}
\newcommand{\bv}{\mathbf{v}}
\newcommand{\bx}{\mathbf{x}}

\newcommand{\Div}{\nabla\cdot}
\newcommand{\eps}{\epsilon}
\newcommand{\grad}{\nabla}
\newcommand{\lap}{\triangle}
\renewcommand{\bar}{\overline}

\newcommand{\ip}[2]{\ensuremath{\left<#1,#2\right>}}

\newcommand{\Span}{\operatorname{span}}

\newenvironment{transbox}[1][]{%
\begin{tikzpicture}
\node[drop shadow,rounded corners,text width=\textwidth,fill=white, fill opacity=#1,text opacity=1] \bgroup
}{
\egroup;\end{tikzpicture}}


\title{A practical view of the classical FEM}

\subtitle{(and some software)}

\author[Bueler]{Ed Bueler}

\institute[UAF]{
  \scriptsize Dept of Mathematics and Statistics \\

  University of Alaska Fairbanks
}

%\titlegraphic{\includegraphics[width=\textwidth]{andycoast.png}}

\beamertemplatenavigationsymbolsempty   % remove faint and silly navigation symbols at bottom
\renewcommand{\insertnavigation}[1]{}   % remove section headings from top of each slide

\setbeamerfont{date}{size=\scriptsize}
\date{}

\AtBeginSection[]
{%
}


\begin{document}
\graphicspath{{figures/}}

\makeatletter
\providecommand*{\input@path}{}
\g@addto@macro\input@path{{tikz/}}% append;   \input@path is like \graphicspath
\makeatother


\begin{frame}
\vspace{10mm}
  \titlepage
  \begin{center}
  \tiny DMS \hfill 27 November 2018
  \end{center}
\end{frame}


\begin{frame}
    \frametitle{Outline}
    \tableofcontents
\end{frame}


\section{nonlinear Poisson problems with general boundary conditions}

\begin{frame}{general, nonlinear Poisson problem}
\begin{itemize}
\item $\Omega \subset \RR^2$ % with disjoint decomposition $\partial \Omega = \partial_D \Omega \cup \partial_N \Omega$
\item recall our usual problem: $\triangle u = f$, $u=0$ on $\partial\Omega$
\item these slides cover a nonlinear version with general boundary conditions:
\begin{align*}
- \Div \left(a(u) \grad u\right) &= f(u)  &&\text{ on } \Omega, \\
u &= g_D &&\text{ on } \partial_D \Omega, \notag \\
\frac{\partial u}{\partial n} &= g_N &&\text{ on } \partial_N \Omega. \notag
\end{align*}
\item $a(u,x,y)$, $f(u,x,y)$, $g_N(x,y)$, $g_D(x,y)$ are given (data)
\item nonlinear because $a=a(u)$ and/or $f=f(u)$ is allowed
%\item for well-posedness:
%    \begin{itemize}
%    \item[$\circ$] assume $a,f,g_N,g_D$ at least $L^2$ in $x,y$
%    \item[$\circ$] expect $f$ to be Lipschitz in $u$
%    \item[$\circ$] assume \emph{uniform ellipticity}: $a(u,x,y) \ge \eps > 0$
%    \end{itemize}
\end{itemize}
\end{frame}


\begin{frame}{general, nonlinear Poisson problem}
\begin{center}
\input{generalpoissondomain.tex}
\end{center}
\end{frame}


\begin{frame}{weak form}
\begin{itemize}
\item $u\in H_g^1(\Omega) = \{u\in H^1(\Omega)\,:\,u=g_D \text{ on } \partial_D\Omega\}$
    \begin{itemize}
    \item[$\circ$] Dirichlet data $g_D$ is used in defining $H^1_g(\Omega)$
    \end{itemize}
\item test functions: $H_0^1(\Omega) = \{v\in H^1(\Omega)\,:\,v=0 \text{ on } \partial_D\Omega\}$
\item for $v\in H^1_0(\Omega)$, multiply PDE by $v$ and integrate by parts:
\begin{equation*}
\int_\Omega a(u) \grad u \cdot \grad v - \int_{\partial\Omega} \frac{\partial u}{\partial n} v = \int_\Omega f(u) v
\end{equation*}
\item apply boundary conditions:
\begin{equation*}
\int_\Omega a(u) \grad u \cdot \grad v = \int_\Omega f(u) v + \int_{\partial_N\Omega} g_N v \tag{WF}
\end{equation*}

\vspace{-2mm}
    \begin{itemize}
    \item[$\circ$] Neumann data $g_N$ appears here
    \end{itemize}
\end{itemize}
\end{frame}


\begin{frame}{examples}
some examples of $- \Div \left(a(u) \grad u\right) = f(u)$:
\begin{itemize}
\item Poisson equation:
    $$-\triangle u=f(x,y), \quad u=0 \text{ on } \partial \Omega$$
\item Liouville-Bratu equation:
    $$-\triangle u = \lambda e^u$$

\vspace{-3mm}
    \begin{itemize}
    \item[$\circ$] critical $\lambda$ for well-posedness
    \end{itemize}
\item porous-medium equation:
    $$-\Div\left((u^{m-1} + \eps)\grad u\right) = f$$

\vspace{-3mm}
    \begin{itemize}
    \item[$\circ$] regularized with $\eps>0$ for uniform ellipticity
    \item[$\circ$] $\eps=0$: degeneracies within domain
    \end{itemize}
\end{itemize}
\end{frame}


\AtBeginSection[]
{
  \begin{frame}<beamer>
    \frametitle{Outline}
    %\tableofcontents[currentsection,hideallsubsections]
    \tableofcontents[currentsection]
  \end{frame}
}


\section{assembly of FEM system}

\begin{frame}{meshes and numbering}
\mbox{\input{blob1elenum.tex} \quad \input{blob1nodenum.tex}}

\begin{itemize}
\item triangulation $\mathcal{T}_h$ of a polygonal domain $\Omega$
\item numbering:
    \begin{itemize}
    \item[$\circ$] $K$ elements ($=21$ above; left)
    \item[$\circ$] $N$ nodes ($=17$ above; right)
    \item[$\circ$] $P$ segments in Neumann boundary ($=7$ above; bold)
    \item[$\circ$] $n_D$ nodes in Dirichlet boundary ($=5$ above)
    \end{itemize}
\item to fully describe mesh, also need node locations $\bx_i=(x_i,y_i)$
\end{itemize}
\end{frame}


\begin{frame}{FEM spaces}
\vspace{4mm}

\begin{itemize}
\item hat functions satisfy:
    \begin{itemize}
    \item[$\circ$] $\psi_j(\bx)$ continuous
    \item[$\circ$] $\psi_j \in P_1$ on each element
    \item[$\circ$] $\psi_j(\bx_i)=\delta_{ij}$
    \end{itemize}

\vspace{-19mm}

\hfill \input{hatfunction.tex}
\item use hat functions to approximate $g_D(\bx)$:
\begin{equation*}
\hat g_D(\bx) = \sum_{l=0}^{n_D-1} g_D(\bx_{j_l}) \psi_{j_l}(\bx) \quad \in C(\overline\Omega)
\end{equation*}
\item use hat functions to define test function space:
\begin{equation*}
S_{0}^h = \Span\left<\psi_j \,:\, \bx_j \notin \partial_D \Omega\right> \subset H_0^1(\Omega)
\end{equation*}
\item \dots and trial function space:
\begin{equation*}
S_{g}^h = \left\{\hat g_D + w \,:\, w \in S_{0}^h\right\} \stackrel{?}{\subset} H_g^1(\Omega)
\end{equation*}
\end{itemize}
\end{frame}


\begin{frame}{FEM spaces}
\begin{itemize}
\item expand the FEM solution $u^h$:
\begin{equation*}
u^h(\bx) = \hat g_D(\bx) + \sum_{\bx_j \notin \partial_D \Omega} u_j\, \psi_j(\bx)
\end{equation*}
\item discrete weak form:  for all $i$ such that $\bx_i \notin \partial_D \Omega$,
\begin{equation*}
\int_\Omega a(u^h) \grad u^h \cdot \grad \psi_i = \int_\Omega f(u^h) \psi_i + \int_{\partial_N\Omega} g_N \psi_i  \tag{DWF}
\end{equation*}
\item $\dim(S_{0}^h)=\dim(S_{g}^h)=N-n_D$
\item however, it is easier to also make Dirichlet boundary nodes into degrees of freedom
    \begin{itemize}
    \item[$\circ$] we assemble a nonlinear system of $N$ equations in $N$ unknowns
    \end{itemize}
\end{itemize}
\end{frame}


\begin{frame}{element residuals}
\begin{itemize}
\item for each element $\triangle_k$ and $\psi_i$, define an \emph{element residual}:
\begin{equation*}
F_i^k(\bu) = \int_{\triangle_k} a(u^h) \grad u^h \cdot \grad \psi_i - f(u^h) \psi_i
\end{equation*}
\item for each edge $s_\nu$ in the Neumann boundary we define
\begin{equation*}
\varphi_i^\nu = \int_{s_\nu} g_N \psi_i
\end{equation*}

\vspace{-2mm}
\item (DWF) becomes:
\begin{equation*}
F_i(\bu) = \sum_{k=0}^{K-1} F_i^k(\bu) - \sum_{\nu=0}^{P-1} \varphi_i^\nu = 0 \qquad \text{ for } \bx_i \notin \partial_D\Omega
\end{equation*}
\item for Dirichlet boundary nodes have easy equation:
\begin{equation*}
F_i(\bu) = u_i - g_D(\bx_i) \qquad \text{ for } \bx_i \in \partial_D\Omega
\end{equation*}
\end{itemize}
\end{frame}


\begin{frame}{assembled FEM system of equations}
\begin{itemize}
\item recall: $N$ is number of nodes in mesh
\item $P^1$ FEM generates an algebraic system of $N$ equations in $N$ unknowns:
\begin{equation*}
\bF(\bu)=0  \tag{$\ast$}
\end{equation*}
    \begin{itemize}
    \item[$\circ$] one equation $F_i(\bu)=0$ per node
    \item[$\circ$] one unknown $u_i$ per node
    \item[$\circ$] nonlinear system if $\partial a/\partial u \ne 0$ and/or $\partial f/\partial u \ne 0$
    \item[$\circ$] sparse because support of a hat function $\psi_i$ only overlaps with a few triangles $\triangle_k$, and thus only a few nodal values $\bu=\{u_j\}$ enter into a given $F_i^k(\bu)$
    \item[$\circ$] $J_{\bF} = (\partial \bF_i/\partial u_j)$ is the \emph{Jacobian}, a sparse matrix
    \end{itemize}
\end{itemize}
\end{frame}


\section{solving the equations}

\begin{frame}{nonlinear residual}
\begin{itemize}
\item the result of FEM assembly is a nonlinear system:
\begin{equation*}
\bF(\bu)=0  \tag{$\ast$}
\end{equation*}
\item the function $\bF:\RR^N \to \RR^N$ is called the  \emph{residual}
    \begin{itemize}
    \item[$\circ$] continuous and differentiable if $a,f$ are
    \end{itemize}
\item propose to solve ($\ast$) by Newton method:
\begin{align*}
    J_\bF(\bu_k) \bp &= - \bF(\bu_k)  \\
    \bu_{k+1} &= \bu_k + \alpha \bp
\end{align*}

\vspace{-2mm}
    \begin{itemize}
    \item[$\circ$] find $\alpha$ using line search based on \emph{merit function} $\Phi(\bu)=\frac{1}{2}\|\bF(\bu)\|^2$
    \item[$\circ$] converges in one step if $a=a(x,y)$ and $f=f(x,y)$ [linear]
    \item[$\circ$] converges quadratically if $a$, $f$ smooth
    \end{itemize}
\end{itemize}
\end{frame}


\begin{frame}{the Jacobian is the FEM stiffness matrix}
\begin{itemize}
\item $J_\bF(\bu)$ is the FEM ``stiffness matrix''
\item example: meshes with $N=7,18,55$ nodes

\bigskip
\input{trap1.tex} \hfill \input{traps.tex}

\vspace{-2mm}
    \begin{itemize}
    \item[$\circ$] generated by uniform refinement of $N=7$ mesh
    \item[$\circ$] $N=18$ mesh not shown
    \end{itemize}
\item sparsity patterns for corresponding $J_\bF(\bu)$:

\bigskip\bigskip
\mbox{\includegraphics[width=0.25\textwidth]{trap1mat} \, \includegraphics[width=0.25\textwidth]{trap2mat} \, \includegraphics[width=0.25\textwidth]{trapsmat}}

\medskip
\end{itemize}
\end{frame}


\begin{frame}{the Newton step is a sparse linear system}
\begin{itemize}
\item $J_\bF(\bu_k) \bp = - \bF(\bu_k)$ is a sparse linear system
    \begin{itemize}
    \item[$\circ$] solve it for the Newton step $\bp$
    \item[$\circ$] actually take the step after line search: $\bu_{k+1} = \bu_k + \alpha\bp$
    \end{itemize}

\item so, how to solve?:
    $$A \bp = \bb$$

\vspace{-3mm}
    \begin{itemize}
    \item[$\circ$] always: $A=J_\bF(\bu_k)$ is sparse $N\times N$ matrix
    \item[$\circ$] if PDE is well-posed: $A=J_\bF(\bu_k)$ is invertible
    \item[$\circ$] if uniformly elliptic and assembled as described: $A=J_\bF(\bu_k)$ is symmetric positive-definite
    \end{itemize}
\end{itemize}
\end{frame}


\begin{frame}{solving sparse linear systems}
\begin{itemize}
\item the Newton step is $A \bp = \bb$ where $A=J_\bF(\bu_k)$
\item $O(N^3)$ dense algorithms are possible:
    \begin{itemize}
    \item[$\circ$] Gaussian elimination (LU decomposition)
    \item[$\circ$] Cholesky decomposition
    \end{itemize}
\item \dots but they struggle for big $N$
    \begin{itemize}
    \item[$\circ$] variable reordering (minimum degree, nested dissection) helps a lot \dots but is still slow
    \end{itemize}
\item modern expectation: use Krylov methods
    \begin{itemize}
    \item[$\circ$] $\mathcal{K}_m(A,\bb) = \left<\bb,A\bb,A^2\bb,\dots,A^{m-1}\bb\right>$ is \emph{Krylov space}
    \item[$\circ$] CG and GMRES are best-known Krylov methods
    \end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{solving sparse linear systems}
\begin{itemize}
\item actually one uses \emph{preconditioned} Krylov methods
\item a \emph{preconditioner} is an $M$ which is spectrally-equivalent to $A$ and such that $M\bp=\bc$ can be rapidly solved
\item for $A\bp=\bb$ the preconditioned system is $M^{-1} A \bp = M^{-1} \bb$
    \begin{itemize}
    \item[$\circ$] $\mathcal{K}_m(M^{-1} A,M^{-1} \bb)$ contains good approximation of $\bp$
    \end{itemize}
\item preconditioners include:
    \begin{itemize}
    \item[$\circ$] diagonal of $A$ \hfill \emph{Jacobi}
    \item[$\circ$] incomplete factorization \hfill \emph{ILU,IC}
    \item[$\circ$] approximate block inverse \hfill \emph{ASM}
    \item[$\circ$] application of multigrid cycles \hfill \emph{GMG,AMG}
    \end{itemize}
\end{itemize}
\end{frame}


\section{modern software: Python/Firedrake/PETSc}

\begin{frame}{modern FEM software}

\begin{itemize}
\item modern FEM software should make this easy
\item application packages:
    \begin{itemize}
    \item[$\circ$] COMSOL Multiphysics  \hfill $\leftarrow$ grew out of a Matlab toolbox
    \item[$\circ$] ABACUS
    \item[$\circ$] Autodesk Simulation
    \item[$\circ$] I don't actually know much about these \dots
    \end{itemize}
\item open source libraries [language]:
    \begin{itemize}
    \item[$\circ$] deal.II [C++]
    \item[$\circ$] libmesh [C++]
    \item[$\circ$] Elmer [Fortran90]
    \item[$\circ$] FEniCS [Python]
    \item[$\circ$] Firedrake [Python]
    \end{itemize}

\end{itemize}
\end{frame}


\begin{frame}{X}
X
\end{frame}


\begin{frame}{X}
X
\end{frame}


\begin{frame}{X}
X
\end{frame}

\begin{frame}{X}
X
\end{frame}

\begin{frame}{X}
X
\end{frame}

\begin{frame}{X}
X
\end{frame}


\section{runtime choices}

\begin{frame}{X}
X
\end{frame}

\begin{frame}{X}
X
\end{frame}

\begin{frame}{X}
X
\end{frame}

\begin{frame}{X}
X
\end{frame}

\begin{frame}{X}
X
\end{frame}

\begin{frame}{X}
X
\end{frame}


\end{document}
